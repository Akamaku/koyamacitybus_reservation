<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ç‹å±±å¸‚äº¤é€šå±€ æ–°ç”ºå–¶æ¥­æ‰€ è»Šä¸¡äºˆç´„</title>
<link rel="stylesheet" href="styles.css">
<style>
  body { font-family: "Hiragino Kaku Gothic ProN", sans-serif; padding: 2em; }
  form { max-width: 420px; display: grid; gap: 1em; margin-bottom: 2em; }
  label { display: grid; gap: .3em; }
  select, input, button { padding: .6em; font-size: 1em; }
  #result, #checkResult { margin-top: 1em; white-space: pre-wrap; border: 1px solid #ccc; padding: 1em; }
  header { margin-bottom: 2em; }
  nav a { margin-right: 1em; text-decoration: none; }
</style>
</head>

<body>
<header class="site-header">
  <a class="brand" href="index.html">ç‹å±±å¸‚äº¤é€šå±€ä¸€éƒ¨è»Šä¸¡äºˆç´„ã‚µã‚¤ãƒˆ</a>
  <nav class="site-nav">
    <a href="shinmachi.html">æ–°ç”ºå–¶æ¥­æ‰€</a>
    <a href="kitano.html">å–œå¤šé‡å–¶æ¥­æ‰€</a>
    <a href="katakami.html">ç‰‡ä¸Šå–¶æ¥­æ‰€</a>
  </nav>
</header>

<h1>æ–°ç”ºå–¶æ¥­æ‰€ è»Šä¸¡äºˆç´„</h1>

<form id="reserveForm">
  <label>è»Šä¸¡ï¼š
    <select name="car" required>
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
      <option value="S-M1415">S-M1415å·è»Š</option>
    </select>
  </label>

    <label>æ—¥ä»˜ï¼š
    <input type="date" name="date" id="date" required>
  </label>

  <label>é–‹å§‹æ™‚åˆ»ï¼š
    <select id="start" name="start" required></select>
  </label>

  <label>çµ‚äº†æ™‚åˆ»ï¼š
    <select id="end" name="end" required></select>
  </label>

  <label>ãŠåå‰ï¼š
    <input name="name" required>
  </label>

  <button type="submit">äºˆç´„ã™ã‚‹</button>
</form>

<div id="result"></div>

<hr>

<h2>ğŸ” äºˆç´„ç¢ºèª</h2>
<form id="checkForm">
  <label>äºˆç´„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š
    <input id="checkPass" required>
  </label>
  <button type="submit">ç¢ºèªã™ã‚‹</button>
</form>

<div id="checkResult"></div>

<script>
const dateInput = document.getElementById('date');
const startSel = document.getElementById('start');
const endSel = document.getElementById('end');
const result = document.getElementById('result');
const checkResult = document.getElementById('checkResult');

// --- æ—¥ä»˜å…¥åŠ›ã®ä¸‹é™ã‚’ä»Šæ—¥ã«è¨­å®šï¼ˆéå»ä¸å¯ï¼‰ ---
const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth() + 1).padStart(2, '0');
const dd = String(today.getDate()).padStart(2, '0');
const todayStr = `${yyyy}-${mm}-${dd}`;
dateInput.min = todayStr;

// --- æ™‚åˆ»ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆï¼ˆ0,15,30,45åˆ†åˆ»ã¿ï¼‰ ---
function generateTimes() {
  startSel.innerHTML = "";
  endSel.innerHTML = "";
  for (let h = 0; h < 24; h++) {
    for (let m of [0,15,30,45]) {
      const t = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
      startSel.add(new Option(t, t));
      endSel.add(new Option(t, t));
    }
  }
}
generateTimes();

// --- äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ ---
document.getElementById('reserveForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const car = fd.get('car');
  const date = fd.get('date');
  const start = fd.get('start');
  const end = fd.get('end');
  const name = fd.get('name');

  // --- å…¥åŠ›æ¤œè¨¼ ---
  if (end <= start) {
    alert("çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }

  // --- ç¾åœ¨ã‚ˆã‚Šéå»ã®æ—¥æ™‚ã¯äºˆç´„ä¸å¯ ---
  const now = new Date();
  const startDateTime = new Date(`${date}T${start}`);
  if (startDateTime < now) {
    alert("éå»ã®æ—¥æ™‚ã¯äºˆç´„ã§ãã¾ã›ã‚“");
    return;
  }

  // --- ãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç™ºè¡Œ ---
  const pass = Math.random().toString(36).slice(-6).toUpperCase();

  // --- ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ ---
  const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
  reservations.push({ car, date, start, end, name, pass });
  localStorage.setItem('reservations', JSON.stringify(reservations));

  // --- çµæœè¡¨ç¤º ---
  result.textContent = 
`äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼
----------------------------
è»Šä¸¡ï¼š${car}
æ—¥ä»˜ï¼š${date}
é–‹å§‹ï¼š${start}
çµ‚äº†ï¼š${end}
ãŠåå‰ï¼š${name}
äºˆç´„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š${pass}
----------------------------
ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§äºˆç´„ç¢ºèªãŒã§ãã¾ã™ã€‚`;

  e.target.reset();
});

// --- äºˆç´„ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ  ---
document.getElementById('checkForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const pass = document.getElementById('checkPass').value.trim().toUpperCase();
  const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
  const found = reservations.find(r => r.pass === pass);

  if (found) {
    checkResult.textContent = 
`äºˆç´„å†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚
----------------------------
è»Šä¸¡ï¼š${found.car}
æ—¥ä»˜ï¼š${found.date}
é–‹å§‹ï¼š${found.start}
çµ‚äº†ï¼š${found.end}
ãŠåå‰ï¼š${found.name}
äºˆç´„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼š${found.pass}`;
  } else {
    checkResult.textContent = "è©²å½“ã™ã‚‹äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
  }
});
</script>
</body>
</html>